# Hibiki UI æµ‹è¯•ç­–ç•¥æ–¹æ¡ˆ
> 2025-09-01

## ğŸ“Š ç°çŠ¶åˆ†æ

### é¡¹ç›®æˆç†Ÿåº¦è¯„ä¼°
- **ä»£ç è§„æ¨¡**: 33ä¸ªPythonæ¨¡å—æ–‡ä»¶ï¼Œçº¦15,000è¡Œä»£ç 
- **æ ¸å¿ƒæ¨¡å—**: 13ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼ˆreactive, component, layout, managersç­‰ï¼‰
- **ç»„ä»¶åº“**: 15+ä¸ªUIç»„ä»¶å·²å®ç°
- **è°ƒè¯•å·¥å…·**: å®Œæ•´çš„debugæ¨¡å—å·²å®ç°ï¼ˆ8ä¸ªæ–‡ä»¶ï¼Œ2922è¡Œï¼‰
- **ç¤ºä¾‹ç¨‹åº**: 12ä¸ªå®Œæ•´ç¤ºä¾‹ï¼Œè¦†ç›–å„ç§ä½¿ç”¨åœºæ™¯

### æµ‹è¯•åŸºç¡€è®¾æ–½
- âœ… **æµ‹è¯•æ¡†æ¶å·²é…ç½®**: pyteståŠç›¸å…³æ’ä»¶å·²åœ¨pyproject.tomlä¸­é…ç½®
- âœ… **è¦†ç›–ç‡å·¥å…·å°±ç»ª**: pytest-covå·²é…ç½®
- âŒ **æ— ç°æœ‰æµ‹è¯•**: é¡¹ç›®å°šæ— ä»»ä½•å•å…ƒæµ‹è¯•
- âŒ **æ— æµ‹è¯•ç›®å½•**: ui/tests/ç›®å½•å°šæœªåˆ›å»º

## ğŸ¯ æµ‹è¯•ç­–ç•¥å»ºè®®

### ä¸ºä»€ä¹ˆç°åœ¨æ˜¯å¼•å…¥æµ‹è¯•çš„æœ€ä½³æ—¶æœº

1. **æ¶æ„å·²ç¨³å®š**: æ ¸å¿ƒååº”å¼ç³»ç»Ÿï¼ˆSignal/Computed/Effectï¼‰APIå·²å®šå‹
2. **åŠŸèƒ½åŸºæœ¬å®Œæ•´**: ä¸»è¦ç»„ä»¶å’ŒåŠŸèƒ½å·²å®ç°å¹¶åœ¨ç¤ºä¾‹ä¸­éªŒè¯
3. **åˆšä¿®å¤å…³é”®Bug**: ScrollableContainerçš„mounté—®é¢˜è¡¨æ˜éœ€è¦å›å½’æµ‹è¯•
4. **å¼€å‘é€Ÿåº¦å¢é•¿**: é¡¹ç›®è§„æ¨¡å¢å¤§ï¼Œæ‰‹åŠ¨æµ‹è¯•æˆæœ¬ä¸Šå‡
5. **è°ƒè¯•å·¥å…·å®Œå–„**: æ–°çš„debugæ¨¡å—å¯è¾…åŠ©æµ‹è¯•å¼€å‘

### æµ‹è¯•é‡‘å­—å¡”è®¾è®¡

```
         /\
        /  \  E2Eæµ‹è¯• (10%)
       /    \ - å®Œæ•´åº”ç”¨åœºæ™¯æµ‹è¯•
      /------\ 
     /        \ é›†æˆæµ‹è¯• (30%)
    /          \ - ç»„ä»¶äº¤äº’æµ‹è¯•
   /            \ - å¸ƒå±€å¼•æ“é›†æˆ
  /--------------\
 /                \ å•å…ƒæµ‹è¯• (60%)
/                  \ - Signal/Computed/Effect
--------------------  - ç»„ä»¶åŸºç¡€åŠŸèƒ½
                      - å·¥å…·å‡½æ•°
```

## ğŸ“‹ åˆ†é˜¶æ®µæµ‹è¯•å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒå•å…ƒæµ‹è¯•ï¼ˆ1å‘¨ï¼‰
**ç›®æ ‡**: ä¸ºæœ€å…³é”®çš„æ ¸å¿ƒæ¨¡å—å»ºç«‹æµ‹è¯•åŸºç¡€

#### 1. ååº”å¼ç³»ç»Ÿæµ‹è¯• `tests/core/test_reactive.py`
```python
# æµ‹è¯•å†…å®¹
- Signalåˆ›å»ºã€è¯»å–ã€æ›´æ–°
- Computedä¾èµ–è¿½è¸ªå’Œç¼“å­˜
- Effectæ‰§è¡Œå’Œæ¸…ç†
- æ‰¹é‡æ›´æ–°ï¼ˆbatch processingï¼‰
- ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
- å¾ªç¯ä¾èµ–æ£€æµ‹
```

#### 2. ç»„ä»¶åŸºç¡€æµ‹è¯• `tests/core/test_component.py`
```python
# æµ‹è¯•å†…å®¹
- UIComponentç”Ÿå‘½å‘¨æœŸï¼ˆmount/unmountï¼‰
- çˆ¶å­å…³ç³»ç®¡ç†
- æ ·å¼åº”ç”¨å’Œç»§æ‰¿
- äº‹ä»¶å¤„ç†
```

#### 3. æ ·å¼ç³»ç»Ÿæµ‹è¯• `tests/core/test_styles.py`
```python
# æµ‹è¯•å†…å®¹
- ComponentStyleåˆ›å»ºå’Œåˆå¹¶
- å•ä½è½¬æ¢ï¼ˆpx, percent, vw, vhï¼‰
- å“åº”å¼æ ·å¼åº”ç”¨
- æ ·å¼ä¼˜å…ˆçº§
```

### ç¬¬äºŒé˜¶æ®µï¼šç»„ä»¶å•å…ƒæµ‹è¯•ï¼ˆ1å‘¨ï¼‰

#### 4. åŸºç¡€ç»„ä»¶æµ‹è¯• `tests/components/test_basic.py`
```python
# æµ‹è¯•å†…å®¹
- Labelæ–‡æœ¬æ¸²æŸ“
- Buttonç‚¹å‡»äº‹ä»¶
- TextFieldè¾“å…¥å¤„ç†
- CheckboxçŠ¶æ€ç®¡ç†
```

#### 5. å¸ƒå±€ç»„ä»¶æµ‹è¯• `tests/components/test_layout.py`
```python
# æµ‹è¯•å†…å®¹
- Containerå­ç»„ä»¶ç®¡ç†
- GridContainerç½‘æ ¼å¸ƒå±€
- ScrollableContaineræ»šåŠ¨ï¼ˆé‡ç‚¹ï¼šå›å½’æµ‹è¯•mounté—®é¢˜ï¼‰
- ResponsiveGridå“åº”å¼å¸ƒå±€
```

### ç¬¬ä¸‰é˜¶æ®µï¼šé›†æˆæµ‹è¯•ï¼ˆ2å‘¨ï¼‰

#### 6. å¸ƒå±€å¼•æ“é›†æˆ `tests/integration/test_layout_engine.py`
```python
# æµ‹è¯•å†…å®¹
- StretchableèŠ‚ç‚¹åˆ›å»ºå’Œå…³ç³»
- å¸ƒå±€è®¡ç®—å‡†ç¡®æ€§
- æ ·å¼åˆ°å¸ƒå±€çš„æ˜ å°„
- å¸ƒå±€æ›´æ–°ä¼ æ’­
```

#### 7. ç®¡ç†å™¨é›†æˆ `tests/integration/test_managers.py`
```python
# æµ‹è¯•å†…å®¹
- AppManagerçª—å£ç®¡ç†
- ViewportManagerå°ºå¯¸ç®¡ç†
- ResponsiveManageræ–­ç‚¹åˆ‡æ¢
- PositioningManageråæ ‡è½¬æ¢
```

### ç¬¬å››é˜¶æ®µï¼šGUIæµ‹è¯•ï¼ˆ2å‘¨ï¼‰

#### 8. macOSç‰¹å®šæµ‹è¯• `tests/gui/test_macos_integration.py`
```python
# æµ‹è¯•å†…å®¹
- NSViewåˆ›å»ºå’Œå±‚æ¬¡
- AppKitäº‹ä»¶å¤„ç†
- åæ ‡ç³»è½¬æ¢ï¼ˆtop-left vs bottom-leftï¼‰
- çª—å£ç”Ÿå‘½å‘¨æœŸ
```

#### 9. è§†è§‰å›å½’æµ‹è¯• `tests/gui/test_visual_regression.py`
```python
# æµ‹è¯•å†…å®¹
- æˆªå›¾å¯¹æ¯”æµ‹è¯•
- å¸ƒå±€ä¸€è‡´æ€§éªŒè¯
- ä¸»é¢˜åˆ‡æ¢æ•ˆæœ
- å“åº”å¼æ–­ç‚¹æ•ˆæœ
```

## ğŸ› ï¸ æµ‹è¯•åŸºç¡€è®¾æ–½å»ºè®¾

### 1. ç›®å½•ç»“æ„
```
ui/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py          # pytesté…ç½®å’Œfixtures
â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒæ¨¡å—æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_reactive.py
â”‚   â”‚   â”œâ”€â”€ test_component.py
â”‚   â”‚   â””â”€â”€ test_styles.py
â”‚   â”œâ”€â”€ components/          # ç»„ä»¶æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_basic.py
â”‚   â”‚   â””â”€â”€ test_layout.py
â”‚   â”œâ”€â”€ integration/         # é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_layout_engine.py
â”‚   â”‚   â””â”€â”€ test_managers.py
â”‚   â”œâ”€â”€ gui/                 # GUIæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_macos_integration.py
â”‚   â”‚   â””â”€â”€ test_visual_regression.py
â”‚   â””â”€â”€ fixtures/            # æµ‹è¯•æ•°æ®
â”‚       â”œâ”€â”€ snapshots/       # è§†è§‰å›å½’å¿«ç…§
â”‚       â””â”€â”€ test_data/       # æµ‹è¯•æ•°æ®æ–‡ä»¶
```

### 2. æµ‹è¯•å·¥å…·ç±»
```python
# tests/conftest.py
import pytest
from hibiki.ui import ManagerFactory

@pytest.fixture
def app_manager():
    """æä¾›æµ‹è¯•ç”¨çš„AppManager"""
    manager = ManagerFactory.get_app_manager()
    yield manager
    manager.cleanup()

@pytest.fixture
def test_window(app_manager):
    """åˆ›å»ºæµ‹è¯•çª—å£"""
    window = app_manager.create_window("Test", 800, 600)
    yield window
    window.close()

@pytest.fixture
def mock_nsview():
    """æ¨¡æ‹ŸNSViewå¯¹è±¡"""
    from unittest.mock import MagicMock
    view = MagicMock()
    view.frame.return_value = ((0, 0), (100, 100))
    return view
```

### 3. æµ‹è¯•è¿è¡Œé…ç½®
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
uv run pytest

# è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
uv run pytest tests/core/test_reactive.py

# è¿è¡Œå¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
uv run pytest --cov=hibiki.ui --cov-report=html

# è·³è¿‡GUIæµ‹è¯•ï¼ˆCIç¯å¢ƒï¼‰
uv run pytest -m "not gui"

# åªè¿è¡Œå¿«é€Ÿæµ‹è¯•
uv run pytest -m "not slow"
```

## ğŸ¯ æµ‹è¯•ç›®æ ‡å’ŒæŒ‡æ ‡

### è¦†ç›–ç‡ç›®æ ‡
- **æ€»ä½“è¦†ç›–ç‡**: 80%+
- **æ ¸å¿ƒæ¨¡å—**: 90%+ï¼ˆreactive, componentï¼‰
- **ç»„ä»¶æ¨¡å—**: 85%+
- **GUIç›¸å…³**: 60%+ï¼ˆç”±äºmacOSé™åˆ¶ï¼‰

### è´¨é‡æŒ‡æ ‡
- **æµ‹è¯•æ‰§è¡Œæ—¶é—´**: < 30ç§’ï¼ˆä¸å«GUIæµ‹è¯•ï¼‰
- **æµ‹è¯•ç¨³å®šæ€§**: æ— éšæœºå¤±è´¥
- **å›å½’é˜²æŠ¤**: 100%å·²çŸ¥bugè¦†ç›–

## ğŸš€ ç«‹å³è¡ŒåŠ¨è®¡åˆ’

### Week 1: åŸºç¡€å»ºè®¾
1. åˆ›å»ºtestsç›®å½•ç»“æ„
2. ç¼–å†™conftest.pyå’ŒåŸºç¡€fixtures
3. å®ç°reactive.pyçš„å®Œæ•´æµ‹è¯•ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
4. å®ç°component.pyåŸºç¡€æµ‹è¯•

### Week 2: æ‰©å±•è¦†ç›–
1. å®Œæˆstyles.pyæµ‹è¯•
2. å¼€å§‹åŸºç¡€ç»„ä»¶æµ‹è¯•
3. é‡ç‚¹ï¼šScrollableContainerå›å½’æµ‹è¯•

### Week 3-4: é›†æˆå’Œä¼˜åŒ–
1. å¸ƒå±€å¼•æ“é›†æˆæµ‹è¯•
2. ç®¡ç†å™¨é›†æˆæµ‹è¯•
3. æ€§èƒ½åŸºå‡†æµ‹è¯•

## ğŸ’¡ ç‰¹æ®Šè€ƒè™‘äº‹é¡¹

### macOS GUIæµ‹è¯•æŒ‘æˆ˜
1. **æ— å¤´æµ‹è¯•å›°éš¾**: macOSä¸æ”¯æŒçœŸæ­£çš„headless GUIæµ‹è¯•
2. **CIé™åˆ¶**: GitHub Actionsçš„macOS runneræœ‰é™åˆ¶
3. **è§£å†³æ–¹æ¡ˆ**: 
   - ä½¿ç”¨mockå¯¹è±¡è¿›è¡Œé€»è¾‘æµ‹è¯•
   - æœ¬åœ°è¿è¡ŒçœŸå®GUIæµ‹è¯•
   - ä½¿ç”¨æˆªå›¾å·¥å…·è¿›è¡Œè§†è§‰éªŒè¯

### Stretchableå¸ƒå±€å¼•æ“æµ‹è¯•
1. **å¤–éƒ¨ä¾èµ–**: Rustç¼–è¯‘çš„äºŒè¿›åˆ¶åº“
2. **æµ‹è¯•ç­–ç•¥**:
   - Mockå¸ƒå±€å¼•æ“æ¥å£è¿›è¡Œå•å…ƒæµ‹è¯•
   - çœŸå®å¼•æ“ç”¨äºé›†æˆæµ‹è¯•
   - æ€§èƒ½åŸºå‡†æµ‹è¯•ç¡®ä¿å¸ƒå±€æ•ˆç‡

### ååº”å¼ç³»ç»Ÿæµ‹è¯•é‡ç‚¹
1. **ç‰ˆæœ¬æ§åˆ¶éªŒè¯**: ç¡®ä¿ç¼“å­˜æ­£ç¡®å·¥ä½œ
2. **æ‰¹å¤„ç†æµ‹è¯•**: éªŒè¯æ›´æ–°å»é‡
3. **å†…å­˜æ³„æ¼æ£€æµ‹**: Effectæ¸…ç†éªŒè¯
4. **æ€§èƒ½å›å½’**: åŸºå‡†æµ‹è¯•é˜²æ­¢æ€§èƒ½é€€åŒ–

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

1. **å¼€å‘æ•ˆç‡æå‡**: å‡å°‘æ‰‹åŠ¨æµ‹è¯•æ—¶é—´50%+
2. **ä»£ç è´¨é‡ä¿è¯**: è‡ªåŠ¨æ£€æµ‹å›å½’é—®é¢˜
3. **é‡æ„ä¿¡å¿ƒ**: æœ‰æµ‹è¯•ä¿æŠ¤çš„å®‰å…¨é‡æ„
4. **æ–‡æ¡£ä»·å€¼**: æµ‹è¯•å³æœ€ä½³ä½¿ç”¨ç¤ºä¾‹
5. **åä½œæ”¹å–„**: æ–°è´¡çŒ®è€…æ›´å®¹æ˜“ç†è§£ä»£ç 

## ğŸ”„ æŒç»­æ”¹è¿›

- æ¯æœˆè¯„å®¡æµ‹è¯•è¦†ç›–ç‡å’Œè´¨é‡
- æ ¹æ®bugæŠ¥å‘Šå¢åŠ å›å½’æµ‹è¯•
- æ€§èƒ½åŸºå‡†æµ‹è¯•è¿½è¸ªä¼˜åŒ–æ•ˆæœ
- æ¢ç´¢å±æ€§æµ‹è¯•ï¼ˆproperty-based testingï¼‰
- è€ƒè™‘å¼•å…¥mutation testing

---

**ç»“è®º**: é¡¹ç›®å·²ç»è¾¾åˆ°å¼•å…¥å•å…ƒæµ‹è¯•çš„æˆç†Ÿåº¦ã€‚å»ºè®®ç«‹å³å¼€å§‹ç¬¬ä¸€é˜¶æ®µï¼Œä¼˜å…ˆä¸ºæ ¸å¿ƒååº”å¼ç³»ç»Ÿå»ºç«‹æµ‹è¯•ï¼Œè¿™å°†ä¸ºæ•´ä¸ªæ¡†æ¶æä¾›åšå®çš„è´¨é‡ä¿è¯åŸºç¡€ã€‚